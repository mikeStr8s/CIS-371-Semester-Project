<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="/src/movie-element/movie-element.html">
<link rel="import" href="/bower_components/app-layout/app-layout.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html">
<link rel="import" href="/bower_components/iron-list/iron-list.html">
<link rel="import" href="/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="movie-element">
    <template>
        <style include="iron-flex iron-flex-alignment"></style>
        <style>
            app-toolbar {
                background-color: #4285f4;
                color: white;
                font-weight: bold;
            }
            #movieList{
                height: 90vh;
                width: 100vw;
            }
            #searchBar {
                --paper-input-container-color: white;
                --paper-input-container-focus-color: white;
            }
            #paperholder{
                padding: 10px;
            }
            :host {
                display: block;
            }
        </style>
        <app-header reveals>
            <app-toolbar>
                <div main-title>Movie Reviews</div>
                <paper-input id="searchBar" label="Search"></paper-input>
                <paper-icon-button on-click="queryMovie" icon="search"></paper-icon-button>
            </app-toolbar>
        </app-header>

        <iron-list id="movieList" as="results">
            <template>
                <div id="paperholder">
                    <paper-card elevation="2">
                        <div class="card-content layout horizontal">
                            <div class="flex">
                                <h1>[[results.title]]</h1>
                            </div>
                            <div class="flex layout vertical">
                                <p>Release Date: [[results.release_date]]</p>
                                <!-- <img  id="posterImg" src="[[results.poster_path]]"> Couldnt get the image to render correctly-->
                            </div>
                        </div>
                    </paper-card>
                </div>
            </template>
        </iron-list>
    </template>

    <script>
        /**
         * @customElement
         * @polymer
         */
        class MovieElement extends Polymer.Element {
            static get is() {
                return 'movie-element';
            }

            static get properties() {
                return {
                    prop1: {
                        type: String,
                        value: 'movie-element'
                    },
                };
            }

            queryMovie() {
                var ironlist = this.$.movieList;
                var queryURL = "https://api.themoviedb.org/3/search/movie?api_key=621dd8327c6b6da21938d21e41f1f9da&query=" + this.$.searchBar.value;
                var resArray = [];
                $.getJSON(queryURL, function (data, status, xhr) {
                    JSON.stringify(data);
                    for(var i = 0; i < data.results.length; i++){
                        resArray.push(data.results[i]);
                        var posterPath = resArray[i].poster_path;
                        resArray[i].poster_path = 'http://image.tmdb.org/t/p/w185/'+posterPath;
                        console.log(resArray[1]);
                    }
                    console.log(data);
                    ironlist.items = resArray;
                }).fail(function () {
                    console.log("no movies");
                })
            }
        }

        window.customElements.define(MovieElement.is, MovieElement);
    </script>
</dom-module>
